sudo: false

notifications:
  - email: false

language: python

matrix:
  allow_failures:
  - os: osx

  include:
  - os: linux
    env: DISTRIB="conda" PYTHON_VERSION="3.5" COVERAGE="true" MINICONDA_URL="https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh"
  - os: linux
    env: DISTRIB="conda" PYTHON_VERSION="3.6" MINICONDA_URL="https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh"
  - os: linux
    env: DISTRIB="conda" PYTHON_VERSION="3.6" EXAMPLES="true" MINICONDA_URL="https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh"


before_install:

  # Here we just install Miniconda, which you shouldn't have to change.

  - wget http://repo.continuum.io/miniconda/Miniconda-latest-Linux-x86_64.sh -O miniconda.sh
  - chmod +x miniconda.sh
  - ./miniconda.sh -b
  - export PATH=/home/travis/miniconda/bin:$PATH
  - conda update --yes conda

install:

  # We just set up a conda environment with the right Python version. This
  # should not need changing.

  - conda create --yes -n test python=$TRAVIS_PYTHON_VERSION
  - source activate test

python:
  - "3.5"
  - "3.6"

install:
  - conda install --file requirements.txt --yes
  - conda install --file requirements_test.txt --yes
  - pip install -r requirements_pip.txt
  - pip install -r requirements_pip_test.txt
  - pip install pytest-cov coveralls
  - python setup.py install

before_script:
  - flake8 --show-source .

script:
  - pytest --cov=convpy .

after_success:
  - coveralls
  - bash <(curl -s https://codecov.io/bash)
